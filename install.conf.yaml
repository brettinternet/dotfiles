# https://github.com/anishathalye/dotbot/tree/master#directives

- defaults:
    link:
      create: true
      relink: true

- clean: ["~", "~/.config", "~/.bin"]

- link:
    ###### User Dotfiles ######
    ~/.env:
      path: user/.env
    ~/.aliases:
      path: user/.aliases
    ~/.bash_profile:
      path: user/.bash_profile
      force: true
    ~/.bashrc:
      path: user/.bashrc
      force: true
    ~/.zshrc:
      path: user/.zshrc
      if: '[ -x "$(command -v zsh)" ]'
    ~/.zprofile:
      path: user/.zprofile
      if: '[ -x "$(command -v zsh)" ]'
    ~/.editorconfig:
      path: user/.editorconfig
    ~/.profile:
      path: user/.profile
    ~/.vimrc:
      path: user/.vimrc
      force: true
    ~/.vimrc.bundles:
      path: user/.vimrc.bundles
    ~/.tmux.conf:
      path: user/.tmux.conf
    ~/.xbindkeysrc:
      path: user/.xbindkeysrc
      if: '[ "$ENABLE_X11" = true ]'
    ~/.xbindkeysrc-mouse:
      path: user/.xbindkeysrc-mouse
      if: 'xinput | grep -q "Logitech MX Master"'
    ~/.xinitrc:
      path: user/.xinitrc
      if: '[ "$ENABLE_X11" = true ]'
    ~/.Xmodmap:
      path: user/.Xmodmap
      if: '[ "$ENABLE_X11" = true ]'
    ~/.xprofile:
      path: user/.xprofile
      if: '[ "$ENABLE_X11" = true ]'
    ~/.Xresources:
      path: user/.Xresources
      if: '[ "$ENABLE_X11" = true ]'
    ~/.screenlayout:
      path: user/.screenlayout
      force: true
      if: '[ "$ENABLE_X11" = true ]'
    ~/.config/:
      glob: true
      path: user/.config/*
      if: '[ "$ENABLE_X11" = true ]'
    ~/.config/chrome-flags.conf:
      path: user/.config/chromium-flags.conf
      if: '[ "$ENABLE_X11" = true ]'
    ###### Laptop ######
    ~/.config/fusuma:
      path: user/.config/fusuma
      if: '[ "$IS_LAPTOP" = "true" ] && [ "$ENABLE_X11" = true ]'
    ~/.config/clight.conf:
      path: user/.config/clight.conf
      if: '[ "$IS_LAPTOP" = "true" ] && [ "$ENABLE_X11" = true ]'

- create:
    - ~/dev
    - ~/dev/me
    - ~/dev/sandbox

- shell:
    # Update dotbot
    - [git submodule update --recursive, Update submodules]
    # Sync pacman package lists
    - command: "/bin/bash ./scripts/sync.sh"
      description: Sync package lists
      stdout: true
      stderr: true
      stdin: true
    # Update vim plugins
    - [vim -c 'PlugUpgrade' -c 'PlugUpdate' -c 'qa!', Update vim-plug]
    # Zinit rehash https://wiki.archlinux.org/index.php/Zsh#Persistent_rehash
    - command: '[[ "$SHELL" = *"zsh" ]] && (REHASH_FILE=$HOME/.cache/zsh/rehash; mkdir -p "${REHASH_FILE%/*}" && /usr/bin/touch -m "$REHASH_FILE") || echo "Skipping...current shell is $SHELL"'
      stdout: true
      stderr: true
      description: Rehash zsh $PATH
    # Some AUR libs may fail without latest rust
    - [rustup update, Update rust]
    # Occasional pacman hygiene commands, perhaps I should automate
    - command: |
        echo "Consider running pacman_clean occasionally from pacman.sh"
      stdout: true
      description: Hints
    # Organize mirror list by rate for recently synchronized servers
    - [
        sudo reflector  --protocol http --protocol https --latest 50 --number 20 --sort rate --save /etc/pacman.d/mirrorlist,
        Organize the mirror list,
      ]
